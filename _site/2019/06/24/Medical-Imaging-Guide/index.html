<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>医学影像简介(Medical Imaging Guide)</title>
    <meta name="description" content="">

    <!-- 网站所有权验证 -->
    <meta name="baidu-site-verification" content="code-kzX4R1yDEi" />
    <meta name="google-site-verification" content="kj0sMKl0iZFsV2KPqmN9OJ3S7aeCrJnNYAOTpJzXCz4" />
    <meta name="msvalidate.01" content="C9A829578EE81A43ECA102B601A5E052" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/zui/1.9.2/css/zui.min.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2019/06/24/Medical-Imaging-Guide/">
    <link rel="alternate" type="application/rss+xml" title="Jarvis' Blog (总有美丽的风景让人流连)" href="http://localhost:4000/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b9d127980a49e998bbedb8aab536a81d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-108096001-2', 'auto');
      ga('send', 'pageview');

    </script>



<script>
window.MathJax = {
  tex: {
    inlineMath: [["$$ "," $$"],["\\(","\\)"]],
    processEscapes: true,
    tags: "all",
    macros: {
      bm: ["{\\boldsymbol #1}",1]
    },
    packages: {'[+]': ['noerrors']}
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['input/asciimath', '[tex]/noerrors']
  }
};
</script>
<script async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js" id="MathJax-script">
</script>
<!-- src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> -->



<!--  -->
    
<script type="text/javascript">
    var host = "jarvis73.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
</script>
</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/index.html" class="brand">Jarvis' Blog (总有美丽的风景让人流连)</a>
        <small>总有美丽的风景让人流连</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/index.html">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/wiki/">
                        
                            <i class="fa fa-book"></i>Wiki
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left-jekyll">
        <h1>医学影像简介(Medical Imaging Guide)</h1>
        <div class="label-custom">

            <div class="label-custom-card">
                <i class="fa fa-calendar"></i>2019-06-24
            </div>

            

            <div class="label-custom-card">
                <i class="fa fa-user"></i>Jarvis
                
            </div>

            <div class="label-custom-card">
                <i class="fa fa-key"></i>Post  
            </div>

            <div class="label-custom-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#图像处理" title="Category: 图像处理" rel="category">图像处理</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#1-术语" id="markdown-toc-1-术语">1. 术语</a>    <ul>
      <li><a href="#11-切面" id="markdown-toc-11-切面">1.1 切面</a></li>
      <li><a href="#12-方向" id="markdown-toc-12-方向">1.2 方向</a></li>
      <li><a href="#13-坐标系统" id="markdown-toc-13-坐标系统">1.3 坐标系统</a>        <ul>
          <li><a href="#131-世界坐标系" id="markdown-toc-131-世界坐标系">1.3.1 世界坐标系</a></li>
          <li><a href="#132-解剖坐标系lpsrasrai" id="markdown-toc-132-解剖坐标系lpsrasrai">1.3.2 解剖坐标系(LPS/RAS/RAI)</a></li>
          <li><a href="#133-图像坐标系" id="markdown-toc-133-图像坐标系">1.3.3 图像坐标系</a></li>
          <li><a href="#134-图像变换" id="markdown-toc-134-图像变换">1.3.4 图像变换</a></li>
          <li><a href="#135-例子" id="markdown-toc-135-例子">1.3.5 例子</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#2-nifti-格式-nii-niigz" id="markdown-toc-2-nifti-格式-nii-niigz">2. Nifti 格式 (<code class="language-plaintext highlighter-rouge">*.nii</code>, <code class="language-plaintext highlighter-rouge">*.nii.gz</code>)</a>    <ul>
      <li><a href="#21-图像读取" id="markdown-toc-21-图像读取">2.1 图像读取</a></li>
      <li><a href="#22-元信息-meta-information" id="markdown-toc-22-元信息-meta-information">2.2 元信息 (meta information)</a>        <ul>
          <li><a href="#221-四元组-quaternion" id="markdown-toc-221-四元组-quaternion">2.2.1 四元组 (quaternion)</a></li>
          <li><a href="#222-qform-仿射矩阵" id="markdown-toc-222-qform-仿射矩阵">2.2.2 <code class="language-plaintext highlighter-rouge">qform</code> 仿射矩阵</a></li>
          <li><a href="#223-sform-仿射矩阵" id="markdown-toc-223-sform-仿射矩阵">2.2.3 <code class="language-plaintext highlighter-rouge">sform</code> 仿射矩阵</a></li>
          <li><a href="#224-qform_code-和-sform_code" id="markdown-toc-224-qform_code-和-sform_code">2.2.4 <code class="language-plaintext highlighter-rouge">qform_code</code> 和 <code class="language-plaintext highlighter-rouge">sform_code</code></a></li>
        </ul>
      </li>
      <li><a href="#23-使用和查看图像" id="markdown-toc-23-使用和查看图像">2.3 使用和查看图像</a>        <ul>
          <li><a href="#231-使用-nibabel-读取" id="markdown-toc-231-使用-nibabel-读取">2.3.1 使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 读取</a></li>
          <li><a href="#232-使用-nibabel-保存" id="markdown-toc-232-使用-nibabel-保存">2.3.2 使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 保存</a></li>
          <li><a href="#232-使用-simpleitk" id="markdown-toc-232-使用-simpleitk">2.3.2 使用 <code class="language-plaintext highlighter-rouge">SimpleITK</code></a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#3-meta-格式-mhdraw" id="markdown-toc-3-meta-格式-mhdraw">3. Meta 格式 (<code class="language-plaintext highlighter-rouge">*.mhd+*.raw</code>)</a>    <ul>
      <li><a href="#31-标签-tags" id="markdown-toc-31-标签-tags">3.1 标签 (tags)</a></li>
    </ul>
  </li>
  <li><a href="#4-dicom-格式-dcm" id="markdown-toc-4-dicom-格式-dcm">4. DICOM 格式 (<code class="language-plaintext highlighter-rouge">*.dcm</code>)</a></li>
  <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
</ul>

<p>本文介绍医学影像的一些基础概念, 几种常用的医学图像格式, 以及常用的 Python包(<code class="language-plaintext highlighter-rouge">nibabel</code>, <code class="language-plaintext highlighter-rouge">SimpleITK</code>)的相关用法. <strong>(未完待续)</strong></p>

<h2 id="1-术语">1. 术语</h2>

<h3 id="11-切面">1.1 切面</h3>

<ul>
  <li>冠状面 (Coronal plane): 分离前后</li>
  <li>矢状面 (Sagittal plane): 分离左右</li>
  <li>横断面 (Transverse plane) / 轴向面(Axial plane): 分离上下</li>
</ul>

<div class="polaroid-script-less">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/planes.png" data-caption="医学图像的切面" />
    
        
        <div class="container">
            <p>图 1. 医学图像的切面</p>
        </div>
    
</div>

<h3 id="12-方向">1.2 方向</h3>

<p>以站立的病人自身为参考, 如: <strong>右侧</strong>表示病人的右侧, 如下图所示. <strong>病人的右侧通常在屏幕上(医学图像)显示在左侧.</strong></p>

<ul>
  <li>左 (<strong>L</strong>eft)</li>
  <li>右 (<strong>R</strong>ight)</li>
  <li>前 (<strong>A</strong>nterior)</li>
  <li>后 (<strong>P</strong>osterior)</li>
  <li>上 (<strong>S</strong>uperior)</li>
  <li>下 (<strong>I</strong>nferior)</li>
</ul>

<div class="polaroid-tiny">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/direction.png" data-caption="医学图像的六个方向" />
    
        
        <div class="container">
            <p>图 2. 医学图像的六个方向</p>
        </div>
    
</div>

<p><strong>注意1:</strong> 使用 up, down, front, back 是不准确的, 因为病人在站立和躺下时这几个概念会混淆, 因此医学中常使用上述的六个(英文)术语来表示上图中的方向.</p>

<p><strong>注意2:</strong> 有时候对于对称的结构(如大脑)也会使用<strong>中部(Medial)</strong> 和<strong>侧边(Lateral)</strong>来表示方位.</p>

<h3 id="13-坐标系统">1.3 坐标系统</h3>

<p>坐标系统有三种: <strong>世界坐标系</strong>, <strong>解剖坐标系</strong>和<strong>图像坐标系</strong>.</p>

<div class="polaroid">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/Coordinate_sytems.png" data-caption="医学图像的不同坐标系统" />
    
        
        <div class="container">
            <p>图 3. 医学图像的不同坐标系统</p>
        </div>
    
</div>

<h4 id="131-世界坐标系">1.3.1 世界坐标系</h4>

<p>世界坐标系是笛卡尔坐标系, 每个模型(model, 指病人)都有自己的世界坐标系. 世界坐标系和解剖坐标系的坐标通常都使用 \((x, y, z)\) 来表示, 注意区分.</p>

<h4 id="132-解剖坐标系lpsrasrai">1.3.2 解剖坐标系(LPS/RAS/RAI)</h4>

<p>也称为病人坐标系, 是医学影像技术中最重要的坐标系. 解剖坐标系是一个连续的三维空间, 图像从该空间中<em>采样</em>. 解剖坐标系使用1.2节中的六个方向作为坐标系的正负轴, 接下来需要确定三个轴的<strong>正方向</strong>. 通常有以下两种:</p>

<ul>
  <li><strong>LPS(Left, Posterior, Superior):</strong> MHD图像(meta image), <a href="https://itk.org">ITK工具包</a>, ITK-Snap软件(该软件中写的是RAI, 下文会解释)使用</li>
  <li><strong>RAS(Right, Anterior, Superior):</strong> Nifti图像和<a href="https://www.slicer.org">3D Slicer软件</a>使用</li>
</ul>

<p>注意以上两种均为<strong>右手坐标系</strong>. 其他的选择(如: RPI)和左手坐标系(如: LAS)也是可能遇到的, 需要注意区分.</p>

<p><strong>警告:</strong> 人们并不总是用三个连续的字母表示正方向, 有时候也表示<strong>出发(from)的方向</strong>(也就是负方向), 此时上面的LPS会被写成RAI, 对应的<strong>到达(to)方向</strong>才是LPS. 比如ITK-Snap软件中<code class="language-plaintext highlighter-rouge">Tools-&gt;Image Information-&gt;Orientation</code>就写的是RAI, 表达的意思是 <code class="language-plaintext highlighter-rouge">from RAI --&gt; to LPS</code> , 同样的使用 ITK 导出的MHD格式图像也是使用From模式.</p>

<h4 id="133-图像坐标系">1.3.3 图像坐标系</h4>

<p>图像坐标系统描述了图像是如何被采样出来的. 所以图像坐标系统中不仅包含了体素值(三维中的像素一般称为<strong>体素 voxel</strong>), 还包含采样<strong>原点(origin)</strong>, 采样<strong>间距(spacing)</strong>等信息.</p>

<ul>
  <li>原点表示图像的第一个体素在解剖坐标系中的坐标, 如(100mm, 50mm, -25mm)</li>
  <li>间距表示沿着每个轴相邻体素之间的距离, 如 (1.5mm, 0.5mm, 0.5mm)</li>
</ul>

<p>下图是一个二维图像原点和间距的示意图.</p>

<div class="polaroid-tiny">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/300px-Image_Coordinats.png" data-caption="图像像素原点和间距示意图" />
    
        
        <div class="container">
            <p>图 4. 图像像素原点和间距示意图</p>
        </div>
    
</div>

<p>通过原点和间距我们就可以计算图像中任意一个体素在解剖坐标系的坐标.</p>

<h4 id="134-图像变换">1.3.4 图像变换</h4>

<p>从图像空间坐标 \((i,j,k)^T\) 变换到解剖空间的坐标 \((x, y, z)^T\) 需要用一个仿射变换, 包含了一个线性变换矩阵 \(\mathbf{A}\) 和一个平移向量 \(\mathbf{t}\) :</p>

\[\left[\begin{matrix}x_1\\x_2\\x_3\end{matrix}\right]=\left[\begin{matrix}A_{11}&amp;A_{12}&amp;A_{13}\\A_{21}&amp;A_{22}&amp;A_{23}\\A_{31}&amp;A_{32}&amp;A_{33}\end{matrix}\right]\left[\begin{matrix}i\\j\\k\end{matrix}\right]+\left[\begin{matrix}t_1\\t_2\\t_3\end{matrix}\right].\]

<p>为了方便我们可以把上式合并为一个矩阵向量乘法:</p>

\[\left[\begin{matrix}x_1\\x_2\\x_3\\1\end{matrix}\right]=\left[\begin{matrix}A_{11}&amp;A_{12}&amp;A_{13}&amp;t_1\\A_{21}&amp;A_{22}&amp;A_{23}&amp;t_2\\A_{31}&amp;A_{32}&amp;A_{33}&amp;t_3\\0&amp;0&amp;0&amp;1\end{matrix}\right]\left[\begin{matrix}i\\j\\k\\1\end{matrix}\right].\]

<p>而上面的 \(4\times4\) 矩阵也根据解剖空间的方向(LPS或RAS)称为 <strong>IJKtoLPS-</strong> 或 <strong>IJKtoRAS-</strong>矩阵.</p>

<h4 id="135-例子">1.3.5 例子</h4>

<p>下面给一个二维的例子.</p>

<div class="polaroid-script">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/550px-IJtoLS.png" data-caption="图像坐标系转解剖坐标系LS" />
    
        
        <div class="container">
            <p>图 5. 图像坐标系转解剖坐标系LS</p>
        </div>
    
</div>

<p>上图中可以看到沿着 \(i\) 增大的方向 Left 轴是增加的, 沿着 \(j\) 增大的方向 Superior 轴是减小的, 因此变换矩阵的对角线上第一行(对应 \(i\)) 是正的, 第二行(对应 \(j\)) 是负的. 没有旋转, 所以变换矩阵只有对角线非零. 两个方向的像素间距均为 \(50\). 像素 \((0, 0)\) 的解剖坐标为 \((50, 300)\), 所以我们最后得到变换矩阵为</p>

\[\nonumber
IJtoLS = \left[\begin{matrix}50&amp;0&amp;50\\0&amp;-50&amp;300\\0&amp;0&amp;1\end{matrix}\right].\]

<div class="polaroid-script">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/550px-IJtoRS.png" data-caption="图像坐标系转解剖坐标系RS" />
    
        
        <div class="container">
            <p>图 6. 图像坐标系转解剖坐标系RS</p>
        </div>
    
</div>

<p>类似地我们可以得到左手坐标系的变换矩阵</p>

\[\nonumber
IJtoLS = \left[\begin{matrix}-50&amp;0&amp;250\\0&amp;-50&amp;300\\0&amp;0&amp;1\end{matrix}\right].\]

<p>有时候我们拿到的图像数据已经包含了变换矩阵, 因此我们可以根据变换矩阵知道使用了哪种坐标系. 需要注意的是我们这里指的图像坐标系是未经过软件变换的. 在具体使用任何软件浏览医学图像时都应当检查坐标原点的位置(可能是左上或左下)后再按照上面的规则进行任何后续的判断.</p>

<h2 id="2-nifti-格式-nii-niigz">2. Nifti 格式 (<code class="language-plaintext highlighter-rouge">*.nii</code>, <code class="language-plaintext highlighter-rouge">*.nii.gz</code>)</h2>

<p><code class="language-plaintext highlighter-rouge">Nifti</code> 格式使用 <code class="language-plaintext highlighter-rouge">RAS (Right, Anterior, Superior)</code> 作为坐标系的正方向.</p>

<h3 id="21-图像读取">2.1 图像读取</h3>

<p>使用 <code class="language-plaintext highlighter-rouge">SimpleITK</code> 读取</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">SimpleITK</span> <span class="k">as</span> <span class="n">sitk</span>
<span class="n">itk_image</span> <span class="o">=</span> <span class="n">sitk</span><span class="p">.</span><span class="nc">ReadImage</span><span class="p">(</span><span class="sh">"</span><span class="s">file_path.nii</span><span class="sh">"</span><span class="p">)</span>
<span class="n">arr_image</span> <span class="o">=</span> <span class="n">sitk</span><span class="p">.</span><span class="nc">GetArrayFromImage</span><span class="p">(</span><span class="n">itk_image</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 读取</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">nibabel</span> <span class="k">as</span> <span class="n">nib</span>
<span class="n">nib_image</span> <span class="o">=</span> <span class="n">nib</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">file_path.nii</span><span class="sh">"</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">nib_image</span><span class="p">.</span><span class="n">header</span>
<span class="n">arr_image</span> <span class="o">=</span> <span class="n">nib_image</span><span class="p">.</span><span class="nf">get_data</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="22-元信息-meta-information">2.2 元信息 (meta information)</h3>

<h4 id="221-四元组-quaternion">2.2.1 四元组 (quaternion)</h4>

<p>在 <code class="language-plaintext highlighter-rouge">Nifti</code> 格式的数据中使用四元组表示旋转矩阵. 从元信息中获取四元组:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">nibabel</span> <span class="k">as</span> <span class="n">nib</span>
<span class="n">nib_image</span> <span class="o">=</span> <span class="n">nib</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">file_path.nii</span><span class="sh">"</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">nib_image</span><span class="p">.</span><span class="n">header</span>
<span class="n">quaternion</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="nf">get_qform_quaternion</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>四元组表示为 \((w, x, y, z)\), 满足 \(w^2+x^2+y^2+z^2=1\). 那么四元组转化成旋转矩阵的公式为</p>

\[\mathbf{R}=\left[\begin{matrix}w^2+x^2-y^2-z^2&amp;2(xy-wz)&amp;2(xz+wy)\\2(xy+wz)&amp;w^2+y^2-x^2-z^2&amp;2(yz-wx)\\2(xz-wy)&amp;2(yz+wx)&amp;w^2+z^2-x^2-y^2\end{matrix}\right]\]

<p>对于未归一化的四元组, 需要归一化后计算旋转矩阵, 公式如下</p>

\[\begin{align}\nonumber
&amp;N = w^2+x^2+y^2+z^2 \\\nonumber
&amp;s=\begin{cases}0&amp;\text{if}~N=0\\ 2/N&amp;\text{otherwise}\end{cases} \\\nonumber \\\nonumber
&amp;wx=s\times w\times x\quad wy=s\times w\times y\quad wz=s\times w\times z \\\nonumber
&amp;xx=s\times x\times x\quad xy=s\times x\times y\quad xz=s\times x\times z \\\nonumber
&amp;yy=s\times y\times y\quad yz=s\times y\times z\quad zz=s\times z\times z \\\nonumber \\
&amp;\mathbf{R}=\left[\begin{matrix}1-yy-zz&amp;xy-wz&amp;xz+wy\\xy+wz&amp;1-xx-zz&amp;yz-wx\\xz-wy&amp;yz+wx&amp;1-xx-yy\end{matrix}\right]
\end{align}\]

<h4 id="222-qform-仿射矩阵">2.2.2 <code class="language-plaintext highlighter-rouge">qform</code> 仿射矩阵</h4>

<ul>
  <li>像素间距 <code class="language-plaintext highlighter-rouge">header['pixdim'][1:4]</code> , 恒为正数</li>
  <li>符号因子 <code class="language-plaintext highlighter-rouge">header['pixdim'][0]</code>, 取值于 <code class="language-plaintext highlighter-rouge">{-1, 1}</code> , 其他值均视为1.</li>
  <li>原点(即偏移) <code class="language-plaintext highlighter-rouge">header['qoffset_x']</code>, <code class="language-plaintext highlighter-rouge">header['qoffset_y']</code>, <code class="language-plaintext highlighter-rouge">header['qoffset_z']</code></li>
</ul>

<p>仿射矩阵 <code class="language-plaintext highlighter-rouge">qform</code> 的构造如下</p>

\[\mathbf{Q} = \left[\begin{matrix}\mathbf{RS}&amp;\mathbf{t}\\\mathbf{0}&amp;1\end{matrix}\right]\]

<p>其中 \(\mathbf{t}=(t_1, t_2, t_3)^T\) 为原点(偏移), \(\mathbf{S}\) 为像素间距 \((s_1~s_2~s_3)\) 拓展的对角阵</p>

\[\mathbf{S}=\left[\begin{matrix}s_1&amp;0&amp;0\\0&amp;s_2&amp;0\\0&amp;0&amp;qs_3\end{matrix}\right]\]

<p>其中 \(q\) 为 <code class="language-plaintext highlighter-rouge">qfac</code> 值, 为符号因子.</p>

<h4 id="223-sform-仿射矩阵">2.2.3 <code class="language-plaintext highlighter-rouge">sform</code> 仿射矩阵</h4>

<p>前三行取自 <code class="language-plaintext highlighter-rouge">header['srow_x']</code>, <code class="language-plaintext highlighter-rouge">header['srow_y']</code>, <code class="language-plaintext highlighter-rouge">header['srow_z']</code> , 最后一行填值 <code class="language-plaintext highlighter-rouge">(0 0 0 1)</code> .</p>

<h4 id="224-qform_code-和-sform_code">2.2.4 <code class="language-plaintext highlighter-rouge">qform_code</code> 和 <code class="language-plaintext highlighter-rouge">sform_code</code></h4>

<p><code class="language-plaintext highlighter-rouge">qform</code> 和 <code class="language-plaintext highlighter-rouge">sform</code> 的存在是为了更灵活的从图像坐标系到解剖坐标系的变换. <code class="language-plaintext highlighter-rouge">Nifti</code> 使用 <code class="language-plaintext highlighter-rouge">qform_code</code> 和 <code class="language-plaintext highlighter-rouge">sform_code</code> 来表示选择哪种方式变换. 如下表</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Code</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Unknown</td>
      <td>0</td>
      <td>任意坐标, 使用方法1</td>
    </tr>
    <tr>
      <td>Scanner_ANAT</td>
      <td>1</td>
      <td>Scanner-based anatomical coordinates.</td>
    </tr>
    <tr>
      <td>Aligned_ANAT</td>
      <td>2</td>
      <td>Coordinates aligned to another file, or to the “truth” (with an arbitrary coordinate center).</td>
    </tr>
    <tr>
      <td>Talairach</td>
      <td>3</td>
      <td>对齐到 <a href="https://en.wikipedia.org/wiki/Talairach_coordinates">Talairach 空间的坐标</a> (人脑的三维坐标系, 即<em>图谱</em>).</td>
    </tr>
    <tr>
      <td>Mni_152</td>
      <td>4</td>
      <td>对齐到 mni 空间的坐标 (另一个人脑三维坐标系).</td>
    </tr>
  </tbody>
</table>

<p>其中 <code class="language-plaintext highlighter-rouge">qform_code</code> 应该包含于 <code class="language-plaintext highlighter-rouge">(0 1 2)</code> (对应于下面的方法2), 而 <code class="language-plaintext highlighter-rouge">sform_code</code> 可以是以上任意一个 Code.</p>

<p><strong>方法1:</strong> 转换仅使用像素间隔</p>

\[\left[\begin{matrix}x_1\\x_2\\x_3\end{matrix}\right]=\left[\begin{matrix}i\\j\\k\end{matrix}\right]\odot\left[\begin{matrix}\text{pixdim[1]}\\\text{pixdim[2]}\\\text{pixdim[3]}\end{matrix}\right].\]

<p>其中 \(\odot\) 表示点乘.</p>

<p><strong>方法2:</strong> 当 <code class="language-plaintext highlighter-rouge">qform_code &gt; 0</code> 时使用该方法</p>

\[\left[\begin{matrix}x_1\\x_2\\x_3\end{matrix}\right]=\mathbf{R}\left[\begin{matrix}i\\j\\qk\end{matrix}\right]\odot\left[\begin{matrix}\text{pixdim[1]}\\\text{pixdim[2]}\\\text{pixdim[3]}\end{matrix}\right]+\left[\begin{matrix}\text{qoffset_x}\\\text{qoffset_y}\\\text{qoffset_z}\end{matrix}\right].\]

<p><strong>方法3:</strong> 当 <code class="language-plaintext highlighter-rouge">sform_code &gt; 0</code> 时使用该方法</p>

\[\left[\begin{matrix}x\\y\\z\\1\end{matrix}\right]=\left[\begin{matrix}\text{srow_x[0]}&amp;\text{srow_x[1]}&amp;\text{srow_x[2]}&amp;\text{srow_x[3]}\\\text{srow_y[0]}&amp;\text{srow_y[1]}&amp;\text{srow_y[2]}&amp;\text{srow_y[3]}\\\text{srow_z[0]}&amp;\text{srow_z[1]}&amp;\text{srow_z[2]}&amp;\text{srow_z[3]}\\0&amp;0&amp;0&amp;1\end{matrix}\right]\left[\begin{matrix}i\\j\\k\\1\end{matrix}\right].\]

<h3 id="23-使用和查看图像">2.3 使用和查看图像</h3>

<h4 id="231-使用-nibabel-读取">2.3.1 使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 读取</h4>

<p>这里主要指使用第三方库 (如 <code class="language-plaintext highlighter-rouge">matplotlib</code>) 使用和查看图像. 由于通常来说第三方库在显示图像时会把左上角的像素坐标设为 \((0, 0)\) , 因此我们通常也希望使用和查看 <code class="language-plaintext highlighter-rouge">Nifti</code> 图像时也能够在左上角像素为 \((0, 0)\) 时图像是<strong>摆正的</strong>.</p>

<div class="polaroid-tiny">
    
    
    
    <img data-toggle="lightbox" src="/images/2019/06/liver.png" data-caption="肝脏图像" />
    
        
        <div class="container">
            <p>图 7. 肝脏图像</p>
        </div>
    
</div>

<p>比如我们从 <code class="language-plaintext highlighter-rouge">Nifti</code> 格式的数据中读取一个肝脏的CT图像, 由于 <code class="language-plaintext highlighter-rouge">Nifti</code> 格式使用的是 RAS 坐标系(即上图中R轴向左, A轴向上), 而图像坐标系相反(i轴向右, j轴向下), 所以只需要让变换矩阵中位置 \((0, 0)\) 的元素和位置 \((1, 1)\) 的元素均为负数即可.</p>

<p>在一般的 <code class="language-plaintext highlighter-rouge">Nifti</code> 图像中, <code class="language-plaintext highlighter-rouge">sform</code> 和 <code class="language-plaintext highlighter-rouge">qform</code> 可能同时存在, 此时使用 <code class="language-plaintext highlighter-rouge">header.get_best_affine()</code> 的读取顺序为</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sform_code</code> 不为0时(0表示unknown), 使用 <code class="language-plaintext highlighter-rouge">sform</code> , 否则</li>
  <li><code class="language-plaintext highlighter-rouge">qform_code</code> 不为0时, 使用 <code class="language-plaintext highlighter-rouge">qform</code>, 否则</li>
  <li>使用默认的仿射矩阵 <code class="language-plaintext highlighter-rouge">header.get_base_affine()</code> , 详细信息参考 <code class="language-plaintext highlighter-rouge">nibabel</code> 相关函数的源码</li>
</ul>

<p>假设我们使用函数 <code class="language-plaintext highlighter-rouge">header.get_best_affine()</code> 从该文件中读取到的变换矩阵 <code class="language-plaintext highlighter-rouge">affine</code> 为</p>

\[\left[\begin{matrix}-0.97656202&amp;0.&amp;0.&amp;249.1000061\\0.&amp;0.97656202&amp;0.&amp;-249.0231781\\0.&amp;0.&amp;2.5&amp;-651\\0.&amp;0.&amp;0.&amp;1.\end{matrix}\right]\]

<p>那么我们发现位置 \(\text{affine}(0, 0)=-0.97656202&lt;0\), 符合要求, 而 \(\text{affine}(1, 1)=0.97656202&gt;0\), 不符合要求, 所以需要对 <code class="language-plaintext highlighter-rouge">j</code> 轴(即 height) 做一个反转即可, 可以用如下的代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">nibabel</span> <span class="k">as</span> <span class="n">nib</span>
<span class="n">nib_image</span> <span class="o">=</span> <span class="n">nib</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">file_path.nii</span><span class="sh">"</span><span class="p">)</span>
<span class="n">affine</span> <span class="o">=</span> <span class="n">nib_image</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="nf">get_best_affine</span><span class="p">()</span>
<span class="n">arr_image</span> <span class="o">=</span> <span class="n">nib_image</span><span class="p">.</span><span class="nf">get_data</span><span class="p">()</span>

<span class="c1"># arr_image: [depth, height, width]
</span><span class="k">if</span> <span class="n">affine</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
	<span class="n">arr_image</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">flip</span><span class="p">(</span><span class="n">arr_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">affine</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
	<span class="n">arr_image</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">flip</span><span class="p">(</span><span class="n">arr_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="232-使用-nibabel-保存">2.3.2 使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 保存</h4>

<p>使用 <code class="language-plaintext highlighter-rouge">nibabel</code> 保存时如果有参照图像的话最好直接使用参照图象的 header 进行保存 (如: label可以使用图像的header). 如果没有可以参照的header时, 就需要自己给定仿射矩阵或者header. 保存的命令如下</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1"># 输入 Nifti1Image 的三维数组的轴应该是 (x, y, z) 的顺序, 而一般之前输出的为 (z, y, x) 的顺序, 所以需要转置一下.
</span><span class="n">out_image</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">transpose</span><span class="p">(</span><span class="n">arr_image</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">nib</span><span class="p">.</span><span class="nc">Nifti1Image</span><span class="p">(</span><span class="n">out_image</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
<span class="n">nib</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这里的 <code class="language-plaintext highlighter-rouge">affine</code> 参数和 <code class="language-plaintext highlighter-rouge">header</code> 参数一般只填一个比较好. 如果有参照图像则直接使用参照图像的 <code class="language-plaintext highlighter-rouge">header</code> , 没有的话使用 <code class="language-plaintext highlighter-rouge">affine</code> 参数. 这里的 <code class="language-plaintext highlighter-rouge">affine</code> 会填充到 <code class="language-plaintext highlighter-rouge">sform</code> 中, 因此是一个 \(4\times4\) 的矩阵. 同样地我们为了符合 <code class="language-plaintext highlighter-rouge">Nifti</code> 的 RAS 坐标体系, 填充以下矩阵可以保证图像是<strong>正的</strong></p>

\[\left[\begin{matrix}-1&amp;0&amp;0&amp;0\\0&amp;-1&amp;0&amp;0\\0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;1\end{matrix}\right].\]

<p>所以如果想要使用 <code class="language-plaintext highlighter-rouge">affine=np.eye(4)</code> 的话, 为了把图像<em>摆正</em>, 就需要在输出前对图像沿x轴和y轴做翻转(显然这样有点多此一举, 因此下次读进来想<em>正着用</em>的话又得做两次翻转).</p>

<h4 id="232-使用-simpleitk">2.3.2 使用 <code class="language-plaintext highlighter-rouge">SimpleITK</code></h4>

<p>使用 <code class="language-plaintext highlighter-rouge">SimpleITK</code> 时我们无法直接获取 <code class="language-plaintext highlighter-rouge">qform</code> 矩阵, 但可以获得所有的元信息. 所以需要按照 2.2 节的讨论使用元信息进行计算, 但是实际上 <code class="language-plaintext highlighter-rouge">SimpleITK</code> 已经帮我们计算好并转化成了 <code class="language-plaintext highlighter-rouge">ITK</code> 格式的方向矩阵.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">SimpleITK</span> <span class="k">as</span> <span class="n">sitk</span>
<span class="n">itk_image</span> <span class="o">=</span> <span class="n">sitk</span><span class="p">.</span><span class="nc">ReadImage</span><span class="p">(</span><span class="sh">"</span><span class="s">file_path.nii</span><span class="sh">"</span><span class="p">)</span>
<span class="n">arr_image</span> <span class="o">=</span> <span class="n">sitk</span><span class="p">.</span><span class="nc">GetArrayFromImage</span><span class="p">(</span><span class="n">itk_image</span><span class="p">)</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">itk_image</span><span class="p">.</span><span class="nc">GetDirection</span><span class="p">()</span>	<span class="c1"># [1, 0, 0, 0, -1, 0, 0, 0, 1] reshape成3x3矩阵即可
</span><span class="k">if</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">arr_image</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">flip</span><span class="p">(</span><span class="n">arr_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">direction</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">arr_image</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">flip</span><span class="p">(</span><span class="n">arr_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>注意到我们上面的讨论都没有考虑 z 方向. 这里是为了讨论的方便, z 方向的规则基本相同, 只需要额外注意乘上 <code class="language-plaintext highlighter-rouge">Nifti</code> 中的符号因子 <code class="language-plaintext highlighter-rouge">qfac</code> 即可.</p>

<h2 id="3-meta-格式-mhdraw">3. Meta 格式 (<code class="language-plaintext highlighter-rouge">*.mhd+*.raw</code>)</h2>

<h3 id="31-标签-tags">3.1 标签 (tags)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>ObjectType = Image
NDims = 3
BinaryData = True
BinaryDataByteOrderMSB = False
CompressedData = False
TransformMatrix = 1 0 0 0 0 -1 0 1 0
Offset = -253.125 -95 250
CenterOfRotation = 0 0 0
AnatomicalOrientation = RSA
ElementSpacing = 1.5625 1.5625 10
DimSize = 322 1078 20
ElementType = MET_SHORT
ElementDataFile = Series28.raw
</pre></td></tr></tbody></table></code></pre></div></div>

<p>说明:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">BinaryDataByteOrderMSB</code> 中的 <code class="language-plaintext highlighter-rouge">MSB</code> 表示 big-endian</li>
  <li><code class="language-plaintext highlighter-rouge">TransformMatrix</code> 为 \(3\times3\) 的矩阵, 按列存储, 上面的一行转换为矩阵是</li>
</ul>

\[\left[\begin{matrix}1&amp;0&amp;0\\0&amp;0&amp;1\\0&amp;-1&amp;0\end{matrix}\right]\]

<ul>
  <li><code class="language-plaintext highlighter-rouge">Offset</code> 为图像的第一个像素在解剖坐标系中的坐标</li>
  <li><code class="language-plaintext highlighter-rouge">CenterOfRotation</code> 旋转中心</li>
  <li><code class="language-plaintext highlighter-rouge">AnatomicalOrientation</code> 为解剖坐标系的From方向(关于From方向和正方向的解释参考1.3.2节). 这里做一个详细的解释:
    <ul>
      <li>该参数实际上是直接从<code class="language-plaintext highlighter-rouge">TransformMatrix</code>中算出来的. Meta Image默认的From方向为RAI, 与ITK相同.</li>
      <li>上例中变换矩阵第三行的非零值为负数, 所以RAI的第三轴变方向, 变为RAS</li>
      <li>变换矩阵第二三行交换了顺序(相对于单位阵), 所以RAS的第二三轴换序, 变为<strong>RSA</strong></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">DimSize</code> 为图像的尺寸</li>
  <li><code class="language-plaintext highlighter-rouge">ElementType</code> 为数据格式, 这里是 <code class="language-plaintext highlighter-rouge">short</code> , 即 16位有符号整数</li>
  <li><code class="language-plaintext highlighter-rouge">ElementDataFile</code> 为数据路径</li>
  <li>数据存储在 <code class="language-plaintext highlighter-rouge">*.raw</code> 文件中, 纯数据文件, 数据的读取的方式根据 <code class="language-plaintext highlighter-rouge">DimSize</code> 和 <code class="language-plaintext highlighter-rouge">ElementType</code> 决定.</li>
</ul>

<h2 id="4-dicom-格式-dcm">4. DICOM 格式 (<code class="language-plaintext highlighter-rouge">*.dcm</code>)</h2>

<p>未完待续…</p>

<h2 id="reference">Reference</h2>

<p>第1节</p>

<ul>
  <li>http://www.grahamwideman.com/gw/brain/orientation/orientterms.htm</li>
  <li>https://www.slicer.org/wiki/Coordinate_systems</li>
</ul>

<p>第2节</p>

<ul>
  <li>https://brainder.org/2012/09/23/the-nifti-file-format/</li>
  <li>https://nipy.org/nibabel/nifti_images.html</li>
</ul>

<p>第3节</p>

<ul>
  <li>https://itk.org/Wiki/ITK/MetaIO/Documentation</li>
  <li>http://www.itksnap.org/pmwiki/pmwiki.php</li>
</ul>


        </article>
        <hr>

        <!-- 
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
         -->

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2019/06/09/Latex-1/">Latex 符号</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2019/06/24/Optimizers-in-Machine-Learning/">机器学习中的优化器(Optimizers in Machine Learning)</a></p>
        
    </div>
</div>


        <!-- <h2 id="comments">Comments</h2>
        



 -->


    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right-jekyll">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id]):not([class])')
    for (var i = 0; i < aTags.length; i++) {
        if (aTags[i].getAttribute('href').startsWith('#'))
        {
            continue
        }
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>

    <footer class="site-footer">


    <div class="wrapper">

        <p class="contact">
            联系我: 
            <a href="https://github.com/jarvis73" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:zjw.math@qq.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   
            <a href="https://www.zhihu.com/people/lin-xi-1-1" title="Zhihu"><i class="iconfont icon-daoruzhihu"></i></a>      
        </p>
        <p>
            <i class="fa fa-eye" style="padding-right: 2px;"></i> 访问量: <span id="busuanzi_value_site_pv"></span>次 | <i class="fa fa-user" style="padding-right: 2px;"></i> 访客数<span id="busuanzi_value_site_uv"></span>人次
        </p>
        <p class="power">
            网站支持 <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a> | 主题支持 <a href="https://github.com/Gaohaoyang/gaohaoyang.github.io">HyG</a> & <a href="https://github.com/Jarvis73/jarvis73.github.io">Jarvis73</a>
        </p>
        <p>
            <img src="/images/misc/beian.png" style="padding-right: 2px; padding-bottom: 4px; vertical-align: middle;" /> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo" class="beian" >浙公网安备 33010602011353号 | </a>
            <a target="_blank" href="https://beian.miit.gov.cn/" class="beian">浙ICP备2020038513号-1</a>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/zui/1.9.2/lib/jquery/jquery.js" charset="utf-8"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/zui/1.9.2/js/zui.min.js" charset="utf-8"></script>
    <script src="/js/index_page.js" charset="utf-8"></script>
    <script src="/js/functions.js" charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
  </body>

</html>
